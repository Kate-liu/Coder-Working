





# 亚马逊的大数据故事：从先驱者到插管吸血开源

全球的互联网大公司里面，如果说哪家公司最有争议性，亚马逊肯定是其中之一。在大数据发展历程中，亚马逊扮演的角色相当复杂，既曾是先驱者，也曾作为“吸血者”插管吸血开源社区。

此外，**亚马逊不仅充分利用 Hadoop 生态圈壮大了自己，而且推出了一些特色化服务。亚马逊的大数据发展比较复杂，它既有对大数据发展作出里程碑式贡献的一面，也有利用了大数据圈的技术大量“插管吸血”却并不回馈社区的一面。** 今天，我们一起来看看亚马逊的大数据故事。

## Dynamo：NoSQL 的先驱之一

除了谷歌，其他公司（比如微软）也或多或少对于大数据时代的发展有一些特色贡献。但**只有亚马逊的这篇名为《Dyanmo：亚马逊的高可用键值存储》（Dynamo: Amazon’s Highly Available Key-value Store）的论文，是唯一一篇可以和谷歌“三驾马车”并驾齐驱，具有同样影响力的论文。** 这篇论文发表于 2007 年的操作系统顶级会议 SOSP 上，它们共同开启了大数据时代。

在 2017 年上海举办的 SOSP 会议上，这篇论文荣获了 SIGOPS 名人堂奖（Hall of Fame Award, HoF）。这是操作系统领域里面的大奖，专门用来表彰那些发表 10 年以上，对业界产生了深远影响的论文。

Dynamo 和 BigTable 功能上很像，也是一个 NoSQL。但是两者在实现方式上非常不一样。简单来说，BigTable 基于排序来实现的 ，而 Dynamo 则基于哈希去实现，当然技术细节不在本文的探讨范围之内。但是，值得注意的是，亚马逊第一次给大家展现了一个全新的键值存储系统（Key-Value Store）是怎么实现的。

Dynamo 也有开源的产品实现，即 Cassandra。Cassandra 先由 Facebook 开发并开源，后期则由 DataStax 公司维护。亚马逊 AWS 把 Dynamo 以 DynamoDB 的名字推出来给客户使用，现在 DynamoDB 是 AWS 历史最为悠久、用户量最大的产品之一。

**Dynamo 论文发表之后，据说在亚马逊内部掀起了轩然大波。很重要的一个原因是，亚马逊传统上是不发表自己的核心技术的。** 所以虽然说亚马逊有全世界最好的编译和软件部署系统阿波罗（Apollo）和最好的版本控制系统巴西（Brazil），但是外界对于亚马逊到底是怎么实现这些东西的并不知晓。

谷歌也在一定程度上奉行这个策略，但是要好一些。比如说，谷歌虽然公布了“三驾马车”，但那是在技术成熟，下一代产品基本就位的时候才公布上一代产品的。至于谷歌最核心的基于容器的调度系统，则有十余年一直被当作核心机密。直到 2015 年，因为 Docker 已经大行其道了才公开。

而亚马逊基本上是完全不公布的政策，而 Dynamo 显然打破了这个规则。有传言贝佐斯对于 Dynamo 团队发表这篇论文，导致亚马逊核心技术泄露表达了强烈不满。这个传言真假不得而知，但是不管怎样，我们能够看到亚马逊后来在核心技术论文发表方面，又小心翼翼起来。

## Elastic MapReduce

如果说 Dynamo 和后来商业化的 DynamoDB 是亚马逊带给整个大数据领域不可磨灭的贡献，亚马逊作为大数据的“先驱者”也因为这篇论文而名垂青史了，Elastic MapReduce 这个云端产品带给亚马逊的则是滚滚财富。

伴随着 Hadoop 生态系统的成熟，很多围绕这个生态圈的创业公司诞生了，这包括后来很著名的 Hadoop 三大发行商：Cloudera、Hortonworks 和 MapR。亚马逊作为一个云厂商，也进入了这个市场，它推出的产品叫作 Elastic MapReduce。

在如何对待开源产品这个事情上，我们必须说，亚马逊和其他公司有很大不同。其他公司不论出于什么样的目的，都或多或少对开源产品本身做出了很大的贡献。Hadoop 的三大发行商在很大程度上维护了 Hadoop 基础架构的开发，Cloudera 和 Hortonworks 一度是 Pig 和 Hive 最重要的维护者。各大社交媒体公司也纷纷开源了很多自己的系统，来丰富整个生态圈。这些公司都对 Hadoop 核心代码做出了很多贡献。

但是亚马逊对于整个 Hadoop 生态圈的贡献，除了如何去连接它自己的云服务（比如 S3）以外，善乏可陈。亚马逊做的事情，典型的做法就是把已成熟的开源社区产品拿过来，在内部做二次开发，以便能够在亚马逊的云端很好得运行。然后，就没有然后了。亚马逊并不会给开源社区贡献自己的核心代码。

一方面来说，因为 Hadoop 生态圈本身就意味着对机器资源的大规模消耗。所以任何使用 Hadoop 的人，在亚马逊的 AWS 服务上，都必然会支付不菲的金钱。因此，亚马逊的 AWS 得到了快速发展。

另外一方面，S3 本身就是世界上最大的存储服务，无数公司把数据存储在 S3 里。AWS 的 Elastic MapReduce 可以有效整合 S3 的数据读写，这也让用户更加离不开 AWS 这个生态圈。

如果我们回过头来看，整个大数据历史的发展中，如果说哪个公司最得利，没有任何一家公司比得上亚马逊的，大数据的发展很大程度上也是亚马逊云计算业务的发展过程。那么，亚马逊对开源的贡献是什么呢？对 Hadoop 生态圈的贡献又是什么？或许，在这一点上还是未来值得思考和期待的事情吧。

有关亚马逊的大数据先驱者和“插管吸血”开源社区的故事就讲到这里了。亲爱的读者，你觉得这种状态是 Hadoop 开源社区错了，被亚马逊“合理利用”了呢？还是亚马逊本身的做法值得商榷呢？







# 亚马逊的大数据故事：创新和拿来并存的云服务

随着大数据的发展，数据处理变得越来越重要，亚马逊的云端数据处理和分析服务也逐渐多起来。亚马逊的这些服务，除去已经提到的 DynamoDB 和 Elastic MapReduce，还有很多。它们的来源大致分为两种：一种是自己开发的，另外一种则是拿开源的包装一下。今天我们就来看一看这些服务。

## Redshift

Redshift 是亚马逊比较早的一个基于云的数据仓库系统。Redshift 是一个兼容 PostgreSQL 8.0.2 版本的数据仓库系统，前端对 SQL 语言的解析复用了 PostgreSQL 8.0.2 版本的源代码，后端最初是基于一家亚马逊投资的公司 ParAccel 的并行数据仓库处理技术。Redshift 在 2012 年以 Beta 版发布，2013 年 2 月正式亮相。

Redshift 无疑是亚马逊最为成功的数据处理云服务之一，或许我们都不需要加“之一”这种说法。Redshift 自诞生开始就受到了中小型企业的欢迎，很多大型企业（比如 Airbnb）也一度使用它。

Redshift 到底有多牛？证据之一，在 2017 年的年度大会 OpenWorld 上，Oracle 创始人拉里 · 埃里森（Larry Elison）在发表主题演讲时，把 Redshift 作为 Oracle 的唯一对标的产品进行了比较。Oracle 在数据库领域的建树，决定了任何一个被 Oracle 作为敌人对待的人，都是在这个领域里面取得了相当成就的。这一次，Redshift 终于“荣幸”地成为了“靶子”。

Redshift 这款产品，长久以来都有自己独立的数据存储方式，用户需要从其他地方把数据导入 Redshift 才可以使用。2017 年 4 月，亚马逊发布了叫作 Redshift Spectrum 的新功能，从而允许 Redshift 直接访问存储在 S3 上的文件。

这个新发布的功能，给业界带来了相当大的震撼。结合亚马逊 S3 存储的无敌和 Redshift 的查询功能，这进一步强化了亚马逊在云端数据处理上的能力。

Redshift 在市场上最大的竞争对手是 Snowflake，这是一家云端弹性数据仓库的创业公司。有关 Snowflake 的故事，我会单独介绍。

## Aurora

Aurora 是亚马逊推出的第二个数据库云端服务，2014 年底推出。如果说 Redshift 是服务于数据仓库和数据分析的，Aurora 主要是亚马逊用于事务处理的服务。

Aurora 和 MySQL 5.6 版本兼容，其存储引擎和 InnoDB 兼容。2017 年的时候，亚马逊又推出了和 PostgreSQL 兼容的 Aurora 数据库。这样一来，两大开源数据库都兼容了。

Aurora 是亚马逊另外一款在云端受欢迎的数据库。亚马逊自己公布的数据显示，Aurora 的性能比传统 MySQL 要快 5 倍，性能提升主要是源于亚马逊自己设计的，属于商业机密的基于 SSD 的存储结构。

Aurora 团队在 2017 年发表了一篇论文，介绍了 Aurora 的实现细节。其中最为创新的地方在于计算引擎往存储层写入东西的时候，可以做得非常轻量级，只需要把日志文件记录传下去就好，文件系统本身实现了对数据的整理和冗余的保证。

结合 Aurora 和 Redshift，亚马逊拥有了关于数据仓库和事务处理全方位的解决方案，这也让它在云端数据库领域越发显得有竞争力。

## Athena

Athena 是亚马逊的一个查询服务，它允许用户直接查询存储在 S3 中的数据。和 Redshift 以及 Aurora 不同，Athena 是 Serverless 架构的，这个服务可以按照计算的需要自动起虚拟机，就能够进行查询。用户不再需要显式的起虚拟机，大大的方便了用户的使用体验。

此外，它与 Aurora 以及 Redshift 还有一点不一样，Athena 是一个拿来主义的产物。它基于开源项目 Presto，这个项目在 Facebook、Airbnb、京东等很多公司都被广泛使用。实际上，按照公布的信息来看，Redshift Spectrum 也是基于 Presto 的技术。

亚马逊当然是对 Presto 进行了很多的改进。但是以亚马逊一贯的作风，这些改进并没有被重新贡献回开源社区。所以指望亚马逊在从开源吸血的时候能够反馈社会，可能过于乐观。

## Kinesis

Kinesis 是亚马逊平台上另外一款重要的产品，它主要针对的是对流数据的导入和分析。从某种程度上来讲，Kinesis 平台对应的开源产品是 Kafka。这一次，亚马逊选择了不用 Kafka，而是自己开发一套具有竞争意义的产品。

这是一个我不太理解的决定。因为 Kafka 在开源社区里面是质量挺高的一款软件，它的用途也很广泛，充分被人证实了是靠谱的选择。亚马逊这个非常擅长“拿来主义”的公司，这次竟然选择了自己去建一个系统。

我后来注意到，这个团队的主管人员是微软里面早年做流计算平台出身的。我想可能这位主管人员觉得，自己的经验搭建一个新产品可能会比 Kafka 更成熟更先进。至于实际效果，我们还需要时间去验证。

但是不管怎样，作为在 AWS 上流计算的唯一选择，Kinesis 推出以来还是吸引了不少用户。这个产品无论如何，结果都应该不会太差。只要 AWS 本身表现可以的话，流计算总是有需求的。

## Glue

Glue 是亚马逊 2017 年最新推出来的云计算服务。它的主要目标是 ETL，ETL 是数据管理整个生态周期中很重要的一环。以前用户需要把数据导入 Redshift 之类的数据库时，需要自己去写 ETL 的管道（pipeline），这无疑非常不方便。

Glue 的推出是亚马逊想要弥补这块市场缺失必然的一步。至于为什么到 2017 年才提上日程，我想数据处理的产品，核心的还是在数据处理，而数据的导入，很多用户有自己成熟的解决方案，其优先级到底有多高不好说。

## QuickSight

严格讲，QuickSight 不是一个数据处理分析工具，而是一个数据可视化服务，主要的服务对象是商业智能仪表盘（BI dashboard）。

亚马逊主推的 QuickSight 和传统的 BI 领导者比起来，还有很多的问题，比如说功能上比较单一。但是它主要的优点是成本低廉，又和亚马逊云端的其他产品紧密集成。所以对于中小企业，不需要太复杂 BI 功能的，这是一个很好的选择。

我们可以看到，亚马逊在云端已经构建了非常完善的大数据处理生态圈，这其中既有开源的，又有自己构建的，这个生态圈足以让亚马逊对任何一个传统的和云端数据处理的提供者展开竞争。

亚马逊在整个大数据的发展历程里，通过 Dynamo 产品给大数据的发展作出了巨大贡献，也体现了一个业界领先企业的创新能力。很多其他的产品，也展现出了亚马逊良好的创新能力。

但是亚马逊从 Hadoop 开源社区获得了很多的便利，却不愿意把自己的改进反馈给开源社区，实际上这种做法动摇了开源社区良性发展的基础，树立了一个坏榜样。所以对于亚马逊在大数据发展过程中的功与过，我们只能以一种很复杂的态度去看待，无法一言以蔽之。































