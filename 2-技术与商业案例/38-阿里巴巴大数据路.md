



# 阿里巴巴的大数据故事：数据分析平台发展史

阿里巴巴是国内最早开始做大数据的公司，也是国内最早开始做云计算的公司。阿里巴巴的数据分析平台非常齐全，今天我带大家看一看阿里巴巴的大数据发展历史。我们首先看看数据分析平台方面的发展。

## MaxCompute

阿里巴巴作为国内最大的互联网公司之一，也需要一个大数据分析平台。阿里巴巴发展大数据平台，走了两条路：一部分业务用的是开源的 Hadoop，另外一部分则用了自己研发的平台。这个自己研发的平台最初叫 ODPS，也就是现在的 MaxCompute。

阿里巴巴的平台研发，时间上比微软、谷歌或者雅虎起步的时候稍微晚了一点。这个平台最初主要做法是前端和 Hive 兼容，使用了 Hive 的语法，后端从查询优化到查询的执行，到数据的存储都是自己开发的。当时负责开发的是徐常亮。

平台的开发一开始并不顺利。但是通过几年的磨合，这个平台也开发得有模有样了，和阿里内部使用开源 Hadoop 的组并驾齐驱。到后来，很多阿里内部业务都泡在了 MaxCompute 上。当然，阿里巴巴的 MapReduce 叫作 E-MapReduce，至今依然是阿里云支持的服务之一。

MaxCompute 在 2015 年迎来了一次大换血。当时微软 Cosmos 部门负责 SCOPE 开发的领导，微软合伙人之一的周靖人加盟阿里云，成为阿里的副总裁兼首席科学家，MaxCompute 成为了他手下负责的方向之一。

此后随着曾在微软 SCOPE 队伍里的中国人的加盟，MaxCompute 的负责人换成了微软来的关涛，同时加盟的还有后来 MaxCompute 的总架构师林伟。这群新来的人对 MaxCompute 的整个框架做了很大的改动，让整个框架更加得模块化。在 2017 年的时候，MaxCompute 第 2 版也顺利发布了。

目前阿里巴巴内部的很多数据分析任务都跑在 MaxCompute 上。这也是就我所知除去谷歌和微软以外，全球第三家不基于 Hadoop 生态圈，而是基于自己开发的系统做大数据分析的公司。

## OceanBase

OceanBase 是另外一个非常重要的产品，严格一点来说它属于蚂蚁金服集团。OceanBase 是阿里巴巴集团的新一代分布式金融关系数据库，主要面向对象是蚂蚁金服集团内部的各种金融业务。

阿里巴巴公司建立的早期，业务主要跑在 Oracle 的数据库上。但是随着时间的推移，Oracle 数据库越发无法支撑阿里巴巴的业务规模，而 Oracle 的昂贵价格也让阿里巴巴的运营成本居高不下，这就有了用自己的软件代替 Oracle 数据库的想法。

阳振坤老师是 OceanBase 项目的负责人。根据 2017 年财富排行榜公布的信息，他的目前身价是 70 亿元。但是阳老师至今依然领导 OceanBase 的工作，为理想而奋斗。

OceanBase 起始于 2009 年，最初是支付宝钱包项目的一个子模块。后来 OceanBase 独立出来，慢慢做成了一个通用的数据库系统，并被用到了蚂蚁金服集团各个不同的项目上。2014 年的 OceanBase 是第一个稳定版本，还一度开源过。但是那个时候的 OceanBase 有一个问题，数据写入时只能从一个节点写入，会造成写操作的瓶颈。

伴随蚂蚁金服业务规模的扩张，这个问题导致 OceanBase 在很多项目上成为瓶颈。2014 年开始研发的新版本最终将这个问题解决掉了。2017 年的时候，按照蚂蚁金服集团非官方的说法，OceanBase 已经全面取代了 Oracle，成为蚂蚁金服主要业务的、唯一的数据库平台。

## PolarDB

阿里巴巴早年大量使用 Oracle，所以培养出了中国最早的一批 Oracle 高手。但是阿里巴巴也是大量使用 MySQL 的，所以集团内部也培养出了第一批 MySQL 的高手。

以俞峰为首的团队是阿里巴巴内部对 MySQL 最为精通的团队之一。这个团队对 MySQL 进行了大量改良，使之支持了阿里巴巴的很多业务，其核心业务主要是在非金融方面。包括 MySQL 的两地三中心主从备份的版本，都是从这个团队里出来的。

2017 年正式发布的 PolarDB，是这个团队把这种 MySQL 的认知发扬光大以后最新的云端产品。如果要对标业界的产品，那么最合适的应该是亚马逊的 Aurora。但是从技术层面上来说，PolarDB 和 Aurora 有很多不一样的地方。

PolarDB 兼容 MySQL 的 API，后端则通过最新的硬件和软件相结合的方式，使性能达到了 MySQL 的 10 倍，同时还可以有效地处理大量的并发请求。这个系统无疑代表了阿里巴巴大数据方面一个很高的里程碑。

当然，在阿里巴巴旗下的数据分析平台，还不只这几个。比如说，阿里巴巴有 HybridDB for Postgress，我们可以认为这是类似亚马逊 Redshift 的产品。此外，阿里巴巴还有对主要的 NoSQL 开源产品的支持，比如说 MongoDB、Redis。这些产品都在 ApsaraDB 的品牌下。

## 重叠的功能

每次我面对阿里巴巴的产品时，都有一个很大的困惑。这些产品看起来是阿里巴巴内部不同的团队独立开发出来的，然后它们作为不同的产品出现在大家面前。

比如说，到今天如果要我在 OceanBase 和 PolarDB 之间给用户推荐一下，我会不知如何决策。因为从功能上看，这两者都是做事务处理的数据库。从宣传上看，两者都很牛，都支持了双十一，当然是在不同的业务上。

这种困惑并非只有我有，知乎上类似的问题很多，各种回答也是众说纷纭，有时候项目负责人也会亲自上场回答问题。但是看完答案， 我的困惑更多了。在阿里巴巴发展的不同时期，不同的团队开发了功能类似的产品，这很正常。但是如果这些产品都一股脑儿摆在用户面前让用户挑选的话，商业上就不知道怎么评价了。











# 阿里巴巴的大数据故事：流计算引擎发展史

在阿里巴巴的发展过程中，流数据处理一直是业务中很重要的一部分。和数据分析平台不一样，阿里巴巴内部的流数据处理平台有很多套。

在阿里巴巴的流数据发展历程里，有两个著名的流引擎 JStorm 和 Blink 依然还在产生着深远的影响。这种影响并不仅仅在阿里巴巴集团的内部，并且扩散到了全球的开源世界。比起其他用于集团内部的流计算引擎，它们更被人所熟知，今天我们就来重点分析一下这两个流计算引擎的发展。

**我们先来说说 Storm 和 JStorm**

Storm 是被 Twitter 收购以后才开源出来的流计算引擎。阿里巴巴集团是在封仲淹带领的团队下才开始使用 Storm 的。

我在之前讲 Storm 的时候说过，这种流计算引擎是用一种比较小众的函数式编程语言 Clojure 开发出来的。国内的 Clojure 专家屈指可数，因此阿里巴巴使用 Storm 时遇到了很多的问题。

毕竟有些时候需要去增加或者改变一些功能，而这也就意味着需要对系统进行改进或者定制，但是 Clojure 语言十分小众，懂这种编程语言的人尚且不多，更不用说专业去修改了，所以，这些都决定了这种工作非常难以展开。

鉴于 Storm 十分难以改进和定制，又是当时开源世界里最成熟的流计算引擎。于是，从 2012 年开始，阿里巴巴决定用 Java 对 Storm 进行重写，这就是 JStorm 项目的由来。

按照封仲淹的观点来说，JStorm 就是 Storm 二次开发的产物。它可以让用户无缝地从 Storm 迁移到 JStorm。

阿里巴巴选择用 Java 进行开发，这让开发进度明显加快。而且，源于阿里巴巴的应用规模、对数据实时性等种种要求，团队对 JStorm 也进行了很多的优化。可以这么说，JStorm 的出现，解决了 Storm 存在的很多问题。

2015 年 11 月 19 日，阿里巴巴集团正式向 Apache 基金会捐赠了 JStorm。JStorm 成为了 Apache Storm 下面的一个子项目，并在 Apache 基金会里继续孵化。

那段时间，JStorm 的作者们对于开源表现出非常大的积极性。封仲淹那时也表示，整个社区的 Storm 2.0 会基于阿里巴巴的 JStorm，用 Java 语言进行开发。

然而世事无常，JStorm 在 Apache 的孵化器里待了快两年，依然没有成为 Apache 基金会的顶级项目。而 Storm2.0 这个以阿里巴巴 JStorm 为主的开发项目更是连影子都没有见到。

对于此事，我非常好奇，但并不真正知晓其答案。只是有次听到一个 Apache 圈内人士聊到过，说阿里巴巴和 Storm 社区之间似乎有了矛盾。

**再来说说 Flink 和 Blink**

Flink 是德国柏林工业大学设计的一个流计算引擎，现在是 Apache 的顶级开源项目。Flink 这个引擎从模型的角度来看是非常先进的，但是在工程实现上却相对薄弱一些。

Flink 也被阿里巴巴集团用到了自己的生产环境中，项目的领导者是曾经在微软 SQL Server 组以及 Facebook 都待过的数据库专家蒋晓伟（花名“量仔”）。

他在接受采访时表示，在 Spark 和 Flink 这两个引擎中，Flink 的设计理念更为先进一些，也更符合阿里巴巴对流计算引擎的要求，这恰恰也是他的团队选择这个引擎的原因。

当然，阿里巴巴集团并没有把 Flink 拿来直接使用，而是对 Flink 进行了大量的、全方位的改造，不仅提高了 Flink 的性能，而且改进了不少功能。这个项目在阿里巴巴内部叫作 Blink，是阿里巴巴集团内部很多业务的流处理引擎，其重要地位可见一斑。

Blink 目前还未开源，但在与社区的合作上，Blink 团队和 Flink 的开发者之间保持了更为友好的关系。Flink 的开发团队多次在公开场合感谢 Blink 团队对 Flink 项目的贡献，Blink 团队也把很多功能都反馈到了 Flink 的代码库里。

为什么 JStorm 和 Blink 同为由阿里巴巴主导的，针对 Apache 已有项目改良的产物，却在和开源社区的互动以及对开源社区的影响方面有着不同的结果。我想，这其中大概有几方面的原因。

首先，Flink 是后起之秀，又来自德国，还是从学校里出来的。在 Flink 流进市场的时候，北美的主要互联网企业要么已经使用了自研的流计算引擎，要么已经基于开源的流计算引擎开展了业务，不太可能短期内更新流计算引擎到 Flink，所以 Flink 本身就需要大客户的支撑，阿里巴巴的出现恰逢其时。

其次是 Flink 团队和阿里巴巴团队的互补性比较强。前者理论基础好，但是没有工业界的开发经验，后者工业界开发经验却很足，这也就让双方的合作有了基础。

最后，也可能是最重要的一点就是，这还是一个面子问题。JStorm 的做法是把 Storm 的整个代码库用另外一个语言完全重写了一遍，这无疑是一种比较得罪人的做法。而 Blink 在贡献回自己的代码时，是在 Flink 原有代码基础上改的，并且改动时也和 Flink 的人做了仔细协商。我想，也许就是这两种不同的合作态度，决定了两个项目的不同结果。

除了这两个流计算引擎以外，阿里巴巴内部还有其他一些流计算引擎（包括 Max Compute 组自己开发的，一个完全和开源社区无关的流计算引擎），但是这些引擎公开的消息很少，我就算是有心想研究它们，却也不知道从何下手了。

不过最新消息称，经过多年不同引擎之间的内部 PK，阿里巴巴在 2018 年终于确定了：未来 Blink 会是阿里巴巴集团统一的流计算引擎。

JStorm 和其他的流计算引擎上的业务都会慢慢迁移过来，最终整个公司的所有流计算引擎的开发和维护资源都会集中到 Blink 上。这也是阿里巴巴集团内部第一次有某种数据处理产品“一统江山”。

两个流计算引擎和开源社区的交流的不同结局告诉我们，和开源社区打交道，仅仅是提供自认为更加厉害的代码给开源社区是远远不够的。尤其是贡献代码的同时却没有给予社区主要贡献者足够的尊重，往往会让事情往坏的方向发展。和社区的合作需要大量持续的互动和交流，以及对社区主要贡献者的尊重。





























